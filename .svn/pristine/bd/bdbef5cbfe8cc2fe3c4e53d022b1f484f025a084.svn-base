import threading
import Queue
from html_parser import *

class TaskController(object):

    def __init__(self):
        super(TaskController, self).__init__()
        self.queue = Queue.Queue()
        self.queue_lock = threading.Lock()

    def enqueue_task(self, task):
        self.queue_lock.acquire()
        self.queue.put(task)
        self.queue_lock.release()

    def dequeue_task(self):

        if not self.is_task_done():
            self.queue_lock.acquire()
            self.data = self.queue.get()
            self.queue_lock.release()
        return self.data.get_result()

    def is_task_done(self):
        return self.queue.task_done()


class Task(threading.Thread):

    def __init__(self, arg, job = None):
        super (Task, self).__init__()
        threading.Thread.__init__(self)
        self.execute = job
        self.arg = arg
        self.result = ""
    def run(self):
        self.result = self.execute( self.arg )

    def get_result(self):
        return self.result

